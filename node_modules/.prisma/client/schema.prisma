generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_DATABASE_URL")
}

//enums
enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum paymentStatus {
  PAID
  UNPAID
  FAILED
}

enum AgencyStatus {
  ACTIVE
  INACTIVE
  PENDING
}

enum PackageStatus {
  ACTIVE
  INACTIVE
}

enum Role {
  ADMIN
  USER
  AGENCY
}

//models

model User {
  id           String      @id @default(uuid())
  email        String      @unique
  name         String
  password     String?
  profileImage String?
  // posts Post[]
  preferences  Json        @default("{}")
  bookings     Booking[]
  feedbacks    Feedbacks[]
  review       Review[]
  itenararyIds String[]
  chatIds      String[]
  isBlock      Boolean     @default(false)
  refreshToken String?     @default("null")
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model UserVerification {
  id         String   @id @default(uuid())
  name       String
  email      String   @unique
  // attemptCount Int @default(0)
  otp        String   @unique
  password   String
  otp_expiry DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Booking {
  id                    String        @id @default(uuid())
  packageId             String
  package               Package       @relation(fields: [packageId], references: [id])
  // agencyId Int
  // agency Agency @relation(fields: [agencyId],references: [id])
  userId                String
  user                  User?         @relation(fields: [userId], references: [id])
  feedbacks             Feedbacks[]
  transaction           Transaction[]
  review                Review[]
  travelDate            String
  peopleCount           Int
  connectiongroupId     String
  totalAmount           Int
  isCancellationAllowed Boolean
  status                BookingStatus
  payment               paymentStatus
  isBooked              Boolean       @default(false)
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
}

model Agency {
  id             String       @id @default(uuid())
  email          String       @unique
  password       String
  name           String
  status         AgencyStatus
  phone          String
  package        Package[]
  transactionId  String
  transaction    Transaction  @relation(fields: [transactionId], references: [id])
  pendingPayouts Int
  totalEarnings  Int
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
}

model Package {
  id           String        @id @default(uuid())
  agencyId     String
  agency       Agency        @relation(fields: [agencyId], references: [id])
  title        String
  description  String
  durationDays Int
  startDates   String
  destination  String
  status       PackageStatus
  maxCapacity  Int
  bookings     Booking[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Transaction {
  id              String        @id @default(uuid())
  agencyId        Int
  agency          Agency[]
  status          paymentStatus
  amount          Int
  initiatedBy     Role          @default(ADMIN)
  relatedBookings Booking[]
  paidAt          DateTime      @default(now())
}

model Feedbacks {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  rating    String
  comment   String
  bookingId String
  booking   Booking  @relation(fields: [bookingId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Review {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  ratings   Int
  bookingId String
  booking   Booking  @relation(fields: [bookingId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
